library(plumber)
library(dplyr)
library(ggplot2)
library(gapminder)
library(IPDfromKM)
library(survminer)
library(jsonlite)

#* Returns countries that satisfy condition
#* @param time
#* @param status 
#* @param arm
#* @get km_table
#* @get km_plot

function(time, status, arm){
  time <- as.numeric(unlist(strsplit(time,",")))
  status <- as.numeric(unlist(strsplit(status,",")))
  arm <- as.numeric(unlist(strsplit(arm,",")))
  ipd <- data.frame(time,status,arm)
  fit_km <- survfit(Surv(time, status) ~ arm, data = ipd)
  km_table  <- surv_median(fit_km)
  km_table
  
}

#km_table URL
"http://127.0.0.1:3448/km_table?time=0.132776935%2C0.34522003%2C0.716995448%2C0.929438543%2C0.969271624%2C1.009104704%2C1.2215478%2C1.274658574%2C1.752655539%2C1.898710167%2C2.097875569%2C2.097875569%2C2.416540212%2C2.469650986%2C2.628983308%2C2.628983308%2C2.628983308%2C2.628983308%2C2.801593323%2C3.000758725%2C3.160091047%2C3.319423369%2C3.47875569%2C3.505311077%2C3.638088012%2C3.74430956%2C3.770864947%2C3.797420334%2C4.062974203%2C4.169195751%2C4.70030349%2C4.70030349%2C4.70030349%2C5.072078907%2C6.612291351%2C6.638846737%2C6.930955994%2C7.037177542%2C7.48861912%2C7.48861912%2C7.780728376%2C8.364946889%2C8.896054628%2C9.135053111%2C9.161608498%2C9.161608498%2C9.506828528%2C9.958270106%2C11.12670713%2C12.34825493%2C12.34825493%2C12.53414264%2C12.6138088%2C13.25113809%2C13.91502276%2C14.55235205%2C14.76479514%2C14.97723824%2C15.73406677%2C15.73406677%2C16.4908953%2C17.05%2C17.05%2C17.05%2C18.53566009%2C19.09332322%2C19.65098634%2C23.08990895%2C23.08990895%2C23.12974203%2C23.15629742%2C23.15629742%2C23.15629742%2C26.39605463%2C26.60849772%2C26.60849772%2C26.84749621%2C33.08801214%2C0.186028853%2C0.345482156%2C0.55808656%2C1.009870919%2C1.036446469%2C1.036446469%2C1.328777525%2C1.541381929%2C1.541381929%2C1.833712984%2C1.860288535%2C1.913439636%2C1.966590737%2C1.966590737%2C2.458238421%2C2.604403948%2C3.056188307%2C3.056188307%2C3.534548216%2C4.30523918%2C4.30523918%2C4.517843584%2C4.889901291%2C4.889901291%2C5.288534548%2C6.032649962%2C6.537585421%2C6.590736522%2C7.069096431%2C7.255125285%2C8.504176158%2C8.690205011%2C10.28473804%2C10.6833713%2C10.6833713%2C12.91571754%2C20.14426727%2C20.15755505&status=1%2C1%2C1%2C1%2C0%2C1%2C1%2C1%2C1%2C0%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C0%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C0%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C0%2C1%2C1%2C1%2C1%2C0%2C0%2C1%2C0%2C0%2C0%2C1%2C0%2C1%2C0%2C0%2C1%2C0%2C0%2C0%2C1%2C0%2C0%2C1%2C0%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C0%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C0&arm=0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C0%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1%2C1"


